<h1 id="deployment">Deployment</h1>
<p>You can set up a production-ready system to orchestrate multiple
vantage points from a dedicated API.</p>
<p>We provide a <a
href="https://github.com/dioptra-io/iris/blob/main/docker-compose.yml"><code>docker-compose.yml</code></a>
file to set up Iris locally. Feel free to adapt it with your own
configurations. Donâ€™t forget to change the default passwords before
pushing it to production!</p>
<p>First, add the following entry to <a
href="file:///etc/hosts"><code>/etc/hosts</code></a>:</p>
<pre><code>127.0.0.1 api.docker.localhost
# The lines below are optional:
127.0.0.1 clickhouse.docker.localhost
127.0.0.1 minio.docker.localhost
127.0.0.1 minio-console.docker.localhost
127.0.0.1 postgres.docker.localhost
127.0.0.1 redis.docker.localhost
127.0.0.1 traefik.docker.localhost</code></pre>
<p>Then run the stack and seed the database:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> up <span class="at">--build</span> <span class="at">--detach</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> exec api .venv/bin/alembic upgrade head</span></code></pre></div>
<p>The API documentation will be available on
http://api.docker.localhost/docs.</p>
<h2 id="users">Users</h2>
<p>By default, a single admin user is created with the email
<code>admin@example.org</code> and the password <code>admin</code>. To
change its email and/or password, run:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Login and retrieve the JWT access token</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> POST <span class="at">-F</span> <span class="st">&#39;username=admin@example.org&#39;</span> <span class="at">-F</span> <span class="st">&#39;password=admin&#39;</span> http://api.docker.localhost/auth/jwt/login</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">TOKEN</span><span class="op">=</span><span class="st">&quot;copy access_token here&quot;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Patch the user</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PATCH <span class="at">-H</span> <span class="st">&quot;Authorization: Bearer </span><span class="va">$TOKEN</span><span class="st">&quot;</span> <span class="at">-H</span> <span class="st">&quot;Content-Type: application/json&quot;</span> <span class="at">-d</span> <span class="st">&#39;{&quot;email&quot;: &quot;new@example.org&quot;, &quot;password&quot;: &quot;newpassword&quot;}&#39;</span> http://api.docker.localhost/users/me</span></code></pre></div>
<h2 id="configuration">Configuration</h2>
<p>In this section we will document the different settings to configure
Iris. Most of the settings are commons to the API, the worker and the
agent components. All of the settings must be declared in the <a
href="https://github.com/dioptra-io/iris/blob/main/docker-compose.yml"><code>docker-compose.yml</code></a>
file for each component.</p>
<table>
<colgroup>
<col style="width: 21%" />
<col style="width: 78%" />
</colgroup>
<thead>
<tr>
<th>Component</th>
<th>Settings location</th>
</tr>
</thead>
<tbody>
<tr>
<td>Commons</td>
<td><a
href="https://github.com/dioptra-io/iris/blob/main/iris/commons/settings.py">iris/commons/settings.py</a></td>
</tr>
<tr>
<td>API</td>
<td><a
href="https://github.com/dioptra-io/iris/blob/main/iris/api/settings.py">iris/api/settings.py</a></td>
</tr>
<tr>
<td>Worker</td>
<td><a
href="https://github.com/dioptra-io/iris/blob/main/iris/worker/settings.py">iris/worker/settings.py</a></td>
</tr>
<tr>
<td>Agent</td>
<td><a
href="https://github.com/dioptra-io/iris/blob/main/iris/agent/settings.py">iris/agent/settings.py</a></td>
</tr>
</tbody>
</table>
